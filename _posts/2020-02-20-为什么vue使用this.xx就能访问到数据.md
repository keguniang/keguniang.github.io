---
layout:     post                    # ä½¿ç”¨çš„å¸ƒå±€ï¼ˆä¸éœ€è¦æ”¹ï¼‰
title:      ä¸ºä»€ä¹ˆvueä½¿ç”¨this.xxå°±èƒ½è®¿é—®åˆ°æ•°æ®              # æ ‡é¢˜ 
date:       2020-02-20              # æ—¶é—´
author:     keguniang                     # ä½œè€…
header-img: img/post-bg-2015.jpg    #è¿™ç¯‡æ–‡ç« æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡
catalog: true                       # æ˜¯å¦å½’æ¡£
tags:                               #æ ‡ç­¾
    - vue
---
# ä¸€. ä»githubè·å–vueå¼€å‘ç‰ˆæœ¬çš„[æºç ](https://github.com/vuejs/vue)

è½¬è‡ªï¼šhttps://www.jianshu.com/p/91ed1ce034c2

```php
git clone https://github.com/vuejs/vue.git
```

# äºŒ. ä»å®ä¾‹åŒ–vue (new vue)å¼€å§‹è®²è§£

> æƒ³äº†è§£â€œä¸ºä»€ä¹ˆVueå®ä¾‹åŒ–åï¼Œé€šè¿‡this.èƒ½è·å–åˆ°dataå†…çš„æ•°æ®â€å¿…é¡»å¯¹callå‡½æ•°å†…ç½®æ–¹æ³•æœ‰æ‰€äº†è§£,å¦‚æœ‰è®¤è¯†æ¨¡ç³Šçš„è¯å¯ä»¥å‚è€ƒ[JSçš„callæ–¹æ³•çš„ä½œç”¨è§£é‡Šï¼Œç®€å•æ˜“æ‡‚](https://blog.csdn.net/ywl570717586/article/details/52681392/)

## 1. new å®ä¾‹åŒ–Vueé¦–å…ˆè¿›å…¥çš„src/core/instance/index.js

```js
// vueå…¶å®å°±æ˜¯ function å®ç°çš„ class
function Vue (options) {
  if (process.env.NODE_ENV !== 'production' &&
    !(this instanceof Vue)
  ) {
    warn('Vue is a constructor and should be called with the `new` keyword')
  }
  // new Vueè¿›è¡Œåˆå§‹åŒ– Vue å¹¶å°†options å‚æ•°ä¼ å…¥_init å†… ï¼Œthis._init æ˜¯åŸå‹ä¸­çš„æ–¹æ³• ,è¿™ä¸ªinitæ–¹æ³•æ¥è‡ªäº â€˜./initâ€™ ä¸­
  this._init(options)
}
```

åœ¨å®ä¾‹åŒ–æ—¶ï¼Œæ‰§è¡Œthis._init(options)ï¼Œè¿™ä¸ª_initå†…ç½®æ–¹æ³•æ˜¯ä¸‹é¢`initMixin(Vue)`å¢åŠ çš„

## 2. è¿›å…¥src/core/instance/init.js æŸ¥çœ‹initMixinæ–¹æ³•

```js
initState(vm) // åˆå§‹åŒ–çŠ¶æ€(è¿™ä¸ªçŠ¶æ€åŒ…å«data props methods), è¿™ä¸ªåˆå§‹åŒ–è§£å†³äº†å®ä¾‹åŒ–æ˜¯é€šè¿‡ this è·å– data 
```

### 3.  è¿›å…¥src/core/instance/state.jsæŸ¥çœ‹initStateæ–¹æ³•

initData(vm)å°±æ˜¯Vueå®ä¾‹åŒ–åï¼Œåˆå§‹åŒ–data é€šè¿‡this.èƒ½è·å–åˆ°dataå†…çš„æ•°æ®

```js
// åˆå§‹åŒ–çŠ¶æ€(è¿™ä¸ªçŠ¶æ€åŒ…å«data props methods), è¿™ä¸ªåˆå§‹åŒ–è§£å†³äº†å®ä¾‹åŒ–æ˜¯é€šè¿‡ this è·å– data props methods å†…æ•°æ®
export function initState (vm: Component) {
  vm._watchers = []
  const opts = vm.$options
  if (opts.props) initProps(vm, opts.props)
  if (opts.methods) initMethods(vm, opts.methods)
  if (opts.data) {
    // åˆå§‹åŒ–data
    initData(vm)
  } else { 
    observe(vm._data = {}, true /* asRootData */)
  }
  if (opts.computed) initComputed(vm, opts.computed)
  if (opts.watch && opts.watch !== nativeWatch) {
    initWatch(vm, opts.watch)
  }
}
```

initMixinå†…æ‰§è¡Œäº†initStateï¼Œåˆå§‹åŒ–dataæ•°æ®

```js
function initData (vm: Component) {
  let data = vm.$options.data
  data = vm._data = typeof data === 'function'
    ? getData(data, vm)
    : data || {}
  if (!isPlainObject(data)) {
    data = {}
    process.env.NODE_ENV !== 'production' && warn(
      'data functions should return an object:\n' +
      'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function',
      vm
    )
  }
  // å¯¹æ¯”props methods dataä¸­çš„ key æ˜¯å¦ç›¸åŒ å¦‚æœç›¸åŒæŠ¥å‡ºè­¦å‘Š  ç¦æ­¢ç›¸åŒ
  // proxy data on instance
  const keys = Object.keys(data)
  const props = vm.$options.props
  const methods = vm.$options.methods
  let i = keys.length
  while (i--) {
    const key = keys[i]
    if (process.env.NODE_ENV !== 'production') {
      if (methods && hasOwn(methods, key)) {
        warn(
          `Method "${key}" has already been defined as a data property.`,
          vm
        )
      }
    }
    if (props && hasOwn(props, key)) {
      process.env.NODE_ENV !== 'production' && warn(
        `The data property "${key}" is already declared as a prop. ` +
        `Use prop default value instead.`,
        vm
      )
    } else if (!isReserved(key)) {
      proxy(vm, `_data`, key)
    }
  }
  // observe data
  observe(data, true /* asRootData */)
}
```

initData æ–¹æ³•ä¸­getDataå°†å°±æ˜¯å®ç°Vueå®ä¾‹åŒ–åï¼Œé€šè¿‡this.èƒ½è·å–åˆ°dataå†…çš„æ•°æ®

```js
data = vm._data = typeof data === 'function'
    ? getData(data, vm)
    : data || {}
```

æˆ‘ä»¬å†çœ‹çœ‹ getDataæ–¹æ³•æ˜¯æ€æ ·å®ç°Vueå®ä¾‹åŒ–åï¼Œé€šè¿‡this.èƒ½è·å–åˆ°dataå†…çš„æ•°æ®

```js
export function getData (data: Function, vm: Component): any {
  // #7573 disable dep collection when invoking data getters
  pushTarget()
  try {
    // data å‡½æ•°æ‰§è¡Œçš„æ—¶å€™å°† return å†…çš„æ•°æ® è¿”å›å‡ºæ¥ vmå‡½æ•°å¯ä»¥é€šè¿‡ this. è·å–åˆ°data å†…çš„æ•°æ® ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å®ä¾‹çš„æ—¶å€™å°† this. èƒ½è·å–åˆ°data å†…æ•°æ®åŸå› 
    return data.call(vm, vm)
  } catch (e) {
    handleError(e, vm, `data()`)
    return {}
  } finally {
    popTarget()
  }
}
```

# ä¸‰ã€æ€»ç»“

ä¸å–å…³å­å•¦ï¼å…¶å®Vueå®ä¾‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡getDataæ–¹æ³•ä¸­callä¿®æ”¹thisæŒ‡é’ˆæ¥å®ç°Vueå®ä¾‹åèƒ½è·å–åˆ°dataä½“å†…çš„æ•°æ®ï¼Œå°ä¼™ä¼´å¯èƒ½æ„Ÿè§‰è®¤ä¸ºæˆ‘å°†vueåˆå§‹åŒ–éƒ¨åˆ†æµç¨‹æ‹‰å‡ºæ¥æ˜¯çš„ä½ è¶Šæ¥è¶Šç³Šæ¶‚ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä¸è®²ä¸Šé¢çš„ä»£ç æ‹‰å‡ºæ¥ï¼Œæˆ‘ç›´æ¥æ¥è¿™å¥æ€»ç»“ï¼Œä½ ä¼šæ›´åŠ æ‡µçš„ğŸ™‚ğŸ™‚ğŸ™‚
